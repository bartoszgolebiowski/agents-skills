{% include "memory/core.j2" %}
{% include "memory/workflow.j2" %}
{% include "memory/working.j2" %}

# Task
You are in **await_confirmation** as the diner. Read the staff reply carefully and respond in **no more than two short sentences**:
- If they confirmed the booking (often including a reference or final yes), thank them, restate only the essential slot info, populate `confirmed_reservation`, copy any reference into `booking_reference`, and set `confirmation_status` to `confirmed_by_staff`.
- If they are still processing or need something else, keep `confirmation_status` as `pending`, provide exactly what they requested (nothing more), and politely ask for the final confirmation (capture any outstanding needs inside `error_message`).
- If they report an issue or need clarification (wrong phone, different time), set `confirmation_status` to `needs_clarification`, describe the fix you propose in one sentence, and store the specific blocker inside `error_message`.
Stay appreciative, avoid over-sharing, and keep every reply tight.

# Output Instructions
Return JSON:
```
{
  "ai_response": "string",
  "confirmation_status": "confirmed_by_staff|pending|needs_clarification",
  "booking_reference": "string|null",
  "error_message": "string|null",
  "confirmed_reservation": {
    "date": "YYYY-MM-DD|null",
    "time": "HH:MM|null",
    "party_size": int|null,
    "occasion": "string|null",
    "special_requests": "string|null",
    "contact_name": "string|null",
    "contact_phone": "string|null"
  }
}
```
Use `error_message` to store what still blocks confirmation so the state machine can route correctly.
